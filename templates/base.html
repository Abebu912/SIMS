<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}Student Information Management System{% endblock %}
    </title>

    {% load static %}
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <style>
      /* Full-page background using project media image (use image.png from MEDIA) */
      body {
          /* Use a single full-page background that covers the viewport without repeating.
            `cover` fills the viewport while preserving aspect ratio. `fixed` keeps the
            background stationary while content scrolls. */
          background-image: url("{{ MEDIA_URL }}image.png");
          background-repeat: no-repeat;
           /* Show the image as a full-bleed background behind the entire page.
             Use `cover` so the image fills the viewport while preserving
             aspect ratio, and position at the top so the logo area appears
             behind the navigation bar. */
           background-position: center top;
           background-attachment: fixed;
           background-size: cover;
        min-height: 100vh;
        margin: 0;
        background-color: #f8f9fa; /* fallback color for areas where image doesn't reach */
      }

      /* Subtle overlay to improve text contrast on top of the image. Content is
         placed above this overlay using z-index. */
      body::before {
        /* Remove the dim overlay so the background image shows clearly
           behind the navigation area and hero. If a contrast overlay is
           needed later, we can add a more targeted gradient instead. */
        content: "";
        position: fixed;
        inset: 0;
        background: transparent;
        pointer-events: none;
        z-index: 0;
      }

      /* Ensure main content and UI elements appear above the overlay */
      header, .navbar, .container, .main-content, .hero, .footer, .top-marquee { position: relative; z-index: 1 }

      /* Let the page background image show through the sidebar and main area.
         Keep link colors readable but remove bulky background effects. */
      .sidebar {
        min-height: 100vh;
        background: transparent;
      }
      .sidebar .nav-link {
        color: rgba(255,255,255,0.95);
        padding: 12px 20px;
        margin: 4px 0;
        border-radius: 8px;
        transition: all 0.3s;
      }
      .sidebar .nav-link:hover,
      .sidebar .nav-link.active {
        background: rgba(255, 255, 255, 0.2);
      }
      /* Make the main content transparent so the image is visible across the page.
         Elements inside can still use cards/backgrounds for readability when necessary. */
      .main-content {
        background-color: transparent;
        min-height: 100vh;
      }
      .stat-card {
        transition: transform 0.3s;
      }
      .stat-card:hover {
        transform: translateY(-5px);
      }
      /* Navbar/header: transparent so the full background image is visible behind the header */
      header.bg-white, .navbar.bg-white, .navbar, header { background: transparent !important; box-shadow: none !important }
      .navbar .nav-link, header .nav-link { color: rgba(255,255,255,0.95) !important }
      .navbar-brand { color: rgba(255,255,255,0.98); font-weight:700; text-shadow:0 1px 2px rgba(0,0,0,0.6) }

      /* Small header-only logo. Uses the same project image but crops to the
         top/logo area so the header shows a compact logo while the remaining
         background image covers the rest of the page. */
      .site-logo {
        width: 140px;
        height: 72px;
        display: inline-block;
        background-image: url("{{ MEDIA_URL }}image.png");
        background-repeat: no-repeat;
        background-position: left top; /* show the top/logo part of the image */
        background-size: 220px auto;
        vertical-align: middle;
        border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      }

      /* Hero/banner that uses the remaining part of the image as a large
         background for the landing page. The small `.hero-logo` presents the
         full logo at the head of the hero section. */
      .hero-banner {
        background-image: url("{{ MEDIA_URL }}image.png");
        background-repeat: no-repeat;
          /* Show the full image for the hero as well (don't crop). Keep it
            centered at the top so the logo portion is visible; `contain` will
            ensure the entire image is shown, and empty space is filled by the
            page background color. */
          background-position: center top;
          background-size: contain;
          background-attachment: fixed;
          padding: 4rem 0 6rem 0;
          min-height: 72vh;
      }
      /* Position a small visible site-logo inside the hero so the landing
         header shows a compact thumbnail (matching the screenshot). */
      .hero-banner .site-logo {
        position: absolute;
        top: 18px;
        left: 28px;
        width: 120px;
        height: 64px;
        background-size: 200px auto;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.18);
        z-index: 2;
      }
      .hero-inner { position: relative; z-index: 1 }
      .hero-logo {
        /* kept for compatibility but hidden â€” the overlay below will show the
           proper logo image inside a white card so this element is unnecessary */
        display: none;
      }

      /* Make hero responsive: reduce logo on small screens */
      @media (max-width: 768px) {
        .hero-logo { width: 260px; height: 120px; background-size: 380px auto }
        .site-logo { width: 110px; height: 58px; background-size: 180px auto }
      }

      /* A centered white card overlay that blocks the page background in a
         specific hero area and displays the full image logo inside. Use this
         when you want the logo to appear exactly inside a rounded section and
         prevent the large background image from peeking through. */
      /* Hide the white overlay on the landing hero so the large background
         image appears like the dashboard background. If you later want the
         white card back, remove this rule. */
      .hero-section-overlay {
        display: none;
      }
      .hero-full-logo {
        width: 100%;
        height: 100%;
        display: block;
      }
      .hero-full-logo img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* fill the overlay and crop if necessary */
        object-position: center top; /* keep the top/logo area visible */
        display: block;
      }
      @media (max-width: 768px) {
        .hero-section-overlay { width: 320px; height: 110px }
        .hero-full-logo { width: 280px; height: 96px; background-size: 400px auto }
      }
    </style>
  </head>
  <body>
    {% if user.is_authenticated %}
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block sidebar">
          <div class="position-sticky pt-4">
            <div class="text-center mb-4">
              <h4 class="text-white">
                <i class="fas fa-graduation-cap"></i> SIMS
              </h4>
              <small class="text-light">Student Information Management</small>
            </div>

            <ul class="nav flex-column">
              <li class="nav-item">
                <a
                  class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
                  href="{% url 'dashboard' %}"
                >
                  <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                </a>
              </li>

              <!-- Student-specific Navigation -->
              {% if user.role == 'student' or user.is_student %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'student_dashboard' %}">
                  <i class="fas fa-tachometer-alt me-2"></i>Student Dashboard
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'subject_registration' %}">
                  <i class="fas fa-clipboard-list me-2"></i>Subject Registration
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'view_transcripts' %}">
                  <i class="fas fa-file-alt me-2"></i>My Transcripts
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'pay_fees' %}">
                  <i class="fas fa-credit-card me-2"></i>Pay Fees
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'interact_with_ai' %}">
                  <i class="fas fa-robot me-2"></i>AI Advisor
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'view_announcements' %}">
                  <i class="fas fa-bullhorn me-2"></i>Announcements
                </a>
              </li>
              {% endif %}

              {% if user.is_admin or user.is_teacher %}
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <i class="fas fa-users me-2"></i>Students
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <i class="fas fa-book me-2"></i>Courses
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <i class="fas fa-chart-bar me-2"></i>Ranks
                </a>
              </li>
              {% endif %}

              {% if user.is_parent %}
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <i class="fas fa-child me-2"></i>My Children
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <i class="fas fa-receipt me-2"></i>Fee Status
                </a>
              </li>
              {% endif %}

              {% if user.is_admin %}
              <li class="nav-item">
                <a class="nav-link" href="/admin">
                  <i class="fas fa-cog me-2"></i>Admin Panel
                </a>
              </li>
              {% endif %}
            </ul>
          </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
          <!-- Navbar -->
          <nav
            class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4"
          >
            <div class="container-fluid">
              <span class="site-logo" aria-hidden="true"></span>
              <span class="navbar-brand"
                >Welcome, {{ user.get_full_name|default:user.username }}</span
              >

              <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    id="navbarDropdown"
                    role="button"
                    data-bs-toggle="dropdown"
                  >
                    <i class="fas fa-user-circle me-1"></i> {{ user.username }}
                    <span
                      class="badge bg-{% if user.role == 'admin' %}danger{% elif user.role == 'teacher' %}info{% elif user.role == 'student' %}success{% elif user.role == 'parent' %}warning{% else %}secondary{% endif %}"
                    >
                      {{ user.get_role_display }}
                    </span>
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="#"
                        ><i class="fas fa-user me-2"></i>Profile</a
                      >
                    </li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                      <a class="dropdown-item" href="{% url 'logout' %}"
                        ><i class="fas fa-sign-out-alt me-2"></i>Logout</a
                      >
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </nav>

          <!-- Messages -->
          {% if messages %}
          <div class="messages mb-4">
            {% for message in messages %}
            <div
              class="alert alert-{{ message.tags }} alert-dismissible fade show"
            >
              {{ message }}
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="alert"
              ></button>
            </div>
            {% endfor %}
          </div>
          {% endif %}

          <!-- Content -->
          <div class="container-fluid">{% block content %}{% endblock %}</div>
        </main>
      </div>
    </div>
    {% else %}
    <div class="hero-banner">
      <div class="hero-inner container">
          {% block auth_content %}{% endblock %}

          <!-- White rounded overlay that hides the page background in this
               area and displays the full logo inside, matching the requested
               section appearance. -->
          <div class="hero-section-overlay" aria-hidden="true">
            <div class="hero-full-logo">
              <img src="{{ MEDIA_URL }}image.png" alt="Site logo">
            </div>
          </div>
      </div>
    </div>
    {% endif %}

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    {% block scripts %}{% endblock %}
  </body>
</html>